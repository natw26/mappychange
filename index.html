<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MappyChange - Walthamstow</title>

  <!-- Fonts and Leaflet CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet" />
  <link rel="icon" href="https://mappychange.com/assets/favicon.ico" />

  <style>
    :root{
      --bg:#fff; --fg:#111; --muted:#6b7280; --accent:#ffd300; --accent-ink:#1a1a1a; --border:#e5e7eb;
    }
    *{ box-sizing:border-box; }
    html, body { height:100%; margin:0; background:var(--bg); color:var(--fg); font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    .app{ display:grid; grid-template-rows:auto 1fr; min-height:100%; }
    header{ border-bottom:1px solid var(--border); background:var(--bg); text-align:center; }
    .container{ max-width:1100px; margin:0 auto; padding:12px 16px; }

    /* Brand */
    .brand{ display:flex; align-items:center; justify-content:center; gap:10px; font-family:'Poppins',sans-serif; font-weight:600; font-size:20px; }
    .brand-icon{ width:32px; height:32px; }
    .brand-icon img{ width:100%; height:100%; object-fit:contain; }
    .tagline{ margin:6px 0 0; font-size:14px; color:var(--muted); }
    
    /* Controls */
    .controls{ display:flex; flex-wrap:wrap; gap:8px; margin-top:12px; align-items:center; justify-content:center; }
    .filter-buttons { display: none; }
    @media (min-width: 1024px) {
      .filter-buttons { display: flex; gap: 8px; }
    }
    @media (max-width: 1023px) {
      .controls{
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }
      .stats { text-align: center; }
    }

    .btn{ padding:10px 16px; border-radius:10px; border:1px solid var(--border); background:#fff; color:var(--fg); font-size:14px; cursor:pointer; font-weight:600; transition:all .15s; }
    .btn:hover{ background:#fafafa; transform: translateY(-1px); }
    .btn.active{ background:var(--accent); border-color:var(--accent); color:var(--accent-ink); }
    .btn:focus{ outline:2px solid var(--accent); outline-offset:2px; }
    
    /* Location button - hero action */
    .btn-locate{ 
      background:var(--accent); 
      border:2px solid var(--fg); 
      color:var(--accent-ink); 
      font-size:15px;
      padding:12px 20px;
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow:0 2px 8px rgba(0,0,0,.15);
    }
    .btn-locate:hover{ 
      transform:translateY(-2px); 
      box-shadow:0 4px 12px rgba(0,0,0,.2); 
    }
    .locate-icon{ width:20px; height:20px; display:flex; align-items:center; justify-content:center; }
    .locate-icon img{ width:100%; height:100%; object-fit:contain; }
    .locate-text{ font-family:'Poppins',sans-serif; }
    
    /* Mobile: make locate button full-width and more prominent */
    @media (max-width: 768px) {
      .controls{ flex-direction:column; align-items:stretch; }
      .btn-locate{ 
        width:100%; 
        justify-content:center; 
        font-size:16px; 
        padding:16px 20px;
        order:-1; /* Always first */
      }
      .btn{ width:100%; justify-content:center; }
      .stats{ width:100%; text-align:center; }
    }

    .stats{ font-size:13px; color:var(--muted); padding:8px 12px; }

    /* Main layout - smaller map for above the fold */
    .main{ position:relative; height:400px; }
    #map{ width:100%; height:100%; background:#f8f9fa; }
    
    @media (min-width: 768px) {
      .main{ height:500px; }
    }
    
    @media (max-width: 768px) {
      .main{ height:250px; }
    }
    @media (max-width: 600px) {
      .main{ height:250px; } /* ensure 250px on small mobiles too */
    }
    
    /* Clean up map controls */
    .leaflet-control-zoom{ border:none; box-shadow:0 2px 8px rgba(0,0,0,.1); }
    .leaflet-control-zoom a{ width:36px; height:36px; line-height:36px; font-size:20px; border:none; background:#fff; color:var(--fg); }
    .leaflet-control-zoom a:hover{ background:var(--accent); color:var(--accent-ink); }
    .leaflet-bar{ border-radius:10px; overflow:hidden; }
    .leaflet-control-attribution{ background:rgba(255,255,255,0.8); border-radius:6px; padding:2px 6px; font-size:11px; }
    
    /* Pin marker styles */
    .pin-inactive{ opacity:0.4; filter:grayscale(100%); }
    .pin-active{ opacity:1; }
    .leaflet-marker-icon{ 
      filter: drop-shadow(0 0 0 2px #000) drop-shadow(0 2px 4px rgba(0,0,0,0.3)); 
      cursor:pointer;
    }
    .leaflet-marker-icon:hover{
      filter: drop-shadow(0 0 0 3px #000) drop-shadow(0 3px 6px rgba(0,0,0,0.4));
      transform: scale(1.1);
    }

    /* Leaflet popup customization */
    .leaflet-popup-content-wrapper{ border-radius:12px; padding:4px; }
    .leaflet-popup-content{ margin:12px; min-width:220px; font-size:14px; }
    
    .popup-title{ font-family:'Poppins',sans-serif; font-weight:600; font-size:16px; margin:0 0 6px; }
    .popup-category{ display:inline-block; padding:4px 10px; background:var(--accent); color:var(--accent-ink); border-radius:999px; font-size:12px; font-weight:600; margin-bottom:8px; text-transform:capitalize; }
    .popup-info{ font-size:13px; line-height:1.6; color:var(--muted); margin-bottom:10px; }
    .popup-info strong{ color:var(--fg); }
    .badge{ display:inline-block; padding:4px 8px; border-radius:6px; font-size:11px; font-weight:600; margin-top:6px; }
    .badge.verified{ background:#10b981; color:#fff; }
    .badge.unverified{ background:#f59e0b; color:#fff; }
    .badge.no-change{ background:#ef4444; color:#fff; }
    
    .navigate-btn{
      display:block;
      width:100%;
      padding:10px 16px;
      background:var(--accent);
      border:2px solid var(--fg);
      border-radius:8px;
      color:var(--accent-ink);
      font-weight:600;
      font-size:14px;
      text-align:center;
      text-decoration:none;
      margin-top:10px;
      transition:all .15s;
      font-family:'Poppins',sans-serif;
    }
    .navigate-btn:hover{
      transform:translateY(-1px);
      box-shadow:0 2px 8px rgba(0,0,0,0.15);
    }

    /* Floating action button */
    .fab{ 
      position:absolute; bottom:16px; right:16px; 
      width:56px; height:56px; border-radius:50%; 
      border:2px solid #111; background:var(--accent); 
      color:var(--accent-ink); font-size:28px; 
      display:flex; align-items:center; justify-content:center; 
      cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.2); 
      transition:transform .15s; z-index:1000; 
      text-decoration:none;
    }
    .fab:hover{ transform:scale(1.05); }
    .fab:focus{ outline:3px solid #000; outline-offset:3px; }

    /* Onboarding Modal */
    .onboarding-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex; align-items: center; justify-content: center;
      z-index: 10000; padding: 1rem;
      opacity: 0; pointer-events: none;
      transition: opacity 0.3s ease;
      backdrop-filter: blur(4px);
    }
    .onboarding-overlay.show {
      opacity: 1; pointer-events: all;
    }

    .onboarding-modal {
      background: white; border-radius: 16px;
      max-width: 520px; width: 100%;
      padding: 2.5rem 2rem; position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      transform: scale(0.9) translateY(30px);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .onboarding-overlay.show .onboarding-modal {
      transform: scale(1) translateY(0);
    }

    .onboarding-icon {
      text-align: center; margin-bottom: 1rem;
      display: flex; align-items: center; justify-content: center;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .onboarding-title {
      font-family: 'Poppins', sans-serif; font-size: 1.75rem; font-weight: 600;
      color: var(--fg); text-align: center; margin-bottom: 0.5rem;
    }
    .onboarding-subtitle {
      font-size: 1rem; color: var(--fg); text-align: center;
      margin-bottom: 1.5rem; font-weight: 500; line-height: 1.4;
    }
    .onboarding-highlight {
      background: linear-gradient(120deg, var(--accent) 0%, var(--accent) 100%);
      background-size: 100% 40%; background-repeat: no-repeat;
      background-position: 0 85%; padding: 0 4px;
    }

    .onboarding-benefits {
      list-style: none; margin: 1rem 0; padding: 0;
    }
    /* Fade-in bullets, 0.8s each, slight stagger */
    .onboarding-benefits li {
      padding: 0.65rem 0; font-size: 0.95rem; color: var(--fg);
      display: flex; align-items: flex-start; gap: 0.75rem;
      animation: fadeAppear 0.8s ease forwards;
      opacity: 0; border-bottom: 1px solid var(--border);
    }
    .onboarding-benefits li:nth-child(1) { animation-delay: 0s; }
    .onboarding-benefits li:nth-child(2) { animation-delay: 0.2s; }
    .onboarding-benefits li:nth-child(3) { animation-delay: 0.4s; }

    @keyframes fadeAppear {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    .onboarding-benefits li::before {
      content: ''; 
      width: 8px; height: 8px; 
      background: var(--accent); 
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 6px;
      border: 2px solid var(--fg);
    }

    .onboarding-cta {
      background: var(--accent); color: var(--accent-ink);
